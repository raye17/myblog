-
- # gorm 配置链路追踪
  collapsed:: true
	- gorm可以通过添加hook的方式采集trace数据，推荐插件[opentelemetry](https://github.com/go-gorm/opentelemetry)
	- 安装依赖
		- ```
		  go get gorm.io/plugin/opentelemetry/tracing
		  ```
	- 使用方法
		- 在初始化 gorm.DB 之后，通过安装插件的方式引入 tracing 和 metrics 。
	- 示例：
		- ```
		  package main
		  
		  import(
		  	"gorm.io/plugin/opentelemetry/tracing"
		  )
		  
		  func init(){
		  
		  	db, err := gorm.Open(sqlite.Open("file::memory:?cache=shared"), &gorm.Config{})
		  	if err != nil {
		  		panic(err)
		  	}
		  
		  	if err := db.Use(tracing.NewPlugin()); err != nil {
		  		panic(err)
		  	}
		  }
		  
		  ```
		- 如果只想采集 tracing 数据，可以按如下方式配置插件。
			- ```
			  package main
			  
			  import(
			  	"gorm.io/plugin/opentelemetry/tracing"
			  )
			  
			  func init(){
			  
			  	db, err := gorm.Open(sqlite.Open("file::memory:?cache=shared"), &gorm.Config{})
			  	if err != nil {
			  		panic(err)
			  	}
			  
			  	if err := db.Use(tracing.NewPlugin(tracing.WithoutMetrics())); err != nil {
			  		panic(err)
			  	}
			  }
			  
			  ```
- # 配置[[jaeger]]查看
	- ## docker启动命令
		- ```
		  docker run -d --name jaeger \
		    -e COLLECTOR_OTLP_ENABLED=true \
		    -p 6831:6831/udp \
		    -p 6832:6832/udp \
		    -p 5778:5778 \
		    -p 16686:16686 \
		    -p 4317:4317 \
		    -p 4318:4318 \
		    jaegertracing/all-in-one:latest
		  
		  -d 选项让容器在后台运行。
		  --name jaeger 为容器设置了一个名称。
		  -e COLLECTOR_OTLP_ENABLED=true 启用了 OTLP（OpenTelemetry Protocol）接收器。
		  -p 选项将容器的端口映射到主机的端口。这些端口用于接收和处理跟踪数据，以及访问 Jaeger Web 界面。
		  jaegertracing/all-in-one:latest 是 Docker 镜像的名称。
		  
		  在 Docker 中运行 Jaeger 时，端口映射（使用 `-p` 选项）是必要的，因为 Jaeger 的各个组件在不同的端口上接收和处理跟踪数据。以下是映射的每个端口的目的：
		  1. 6831/udp 和 6832/udp：这些端口用于接收 Jaeger Agent 发送的跟踪数据。Jaeger Agent 可以通过这些端口使用 UDP 协议发送跟踪数据。
		  2. 5778：这个端口用于接收 Jaeger Agent 发送的压缩的跟踪数据。Jaeger Agent 可以通过这个端口使用 HTTP 协议发送压缩的跟踪数据。
		  3. 16686：这个端口用于访问 Jaeger Query Service 的 Web 界面。在浏览器中访问这个端口来查看服务和跟踪数据。
		  4. 4317 和 4318：这些端口用于接收 OpenTelemetry Collector 发送的跟踪数据。你的应用程序可以通过这些端口使用 gRPC 或 HTTP 协议发送跟踪数据。
		  每个端口都有特定的用途，所以需要将它们都映射到主机的端口，以便应用程序和 Jaeger 的各个组件可以正确地通信。
		  ```